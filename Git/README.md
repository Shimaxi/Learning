# Gitについて学んでいきます

# Gitの基本的な概念について
こちらの記事が滅茶苦茶参考になりました。
>https://qiita.com/nnahito/items/e546b27f73e7be131d4e

Gitとは一言で言ってしまうと超便利な『バージョン管理システム』のことです。

後で改めて説明しますが『リポジトリ』や『ブランチ』といった概念により、多人数が同じプログラムを同時に弄ったりした時であっても、誰が何を弄ったのかの記録が残り、バージョンがこんがらがらないようにしてくれます。

# GitとGitHubの初期設定
こちらの資料を参考にしました。
>【Windows】Gitの環境構築をしよう！
>https://prog-8.com/docs/git-env-win

構築が大体できたら、GitHubのデフォルトブランチ名が"master"から"main"になったことに合わせて、git上でも
```
git config --global init.defaultBranch main
```
でデフォルトのブランチ名を変更しておいてください。
(いや、しなくてもいいんだけど、なんかしといた方が良いみたいなの見て、いやどうなんだろ...分からん...)

# Gitの基本操作(一人向け)

まずは一人でgitの作業をすることを考えて、基本的な操作についてまとめていきます。

# ローカルのフォルダをGithubにアップロードする方法

直近でやる必要があったので、ここから説明していきます。

## cd ○○
まず、gitbashを起動します。そうしたら、自分がアップロードしたいファイルがあるフォルダに行きましょう。

gitbashでのスタート地点は『C:\Users\<ユーザー名>』です。そこから目的のフォルダまで"cd ○○(フォルダ名)"コマンドでどんどん進んでいきましょう。

例えば
```
cd Doucument/Learning
```
とすると、『C:\Users\<ユーザー名>\Documents\Learning』までやってこれます。
コマンドラインに『~/Documents/Learning』というのがくっつくので、上手くできたかどうかはここで確認しましょう。

## git init
次にこのフォルダを『ローカルリポジトリ』とするための宣言を行います。

リポジトリとは『倉庫』や『貯蔵庫』の意味で、ここを自分の活動拠点とする宣言と思ってください。

宣言の仕方は
```
git init
```
と書くだけです。

コマンドラインに『(main)』というのがくっつくと思います。

## git remote add origin

そうしたら、このローカルリポジトリをどこに向かって送るかを設定します。

ここでgithubの出番です。アップロードしたいgithub上の『リモートリポジトリ』のURLを持ってきて、コンピュータに教えてあげましょう。

楽な方法は、githubでリポジトリの画面を開き、『<> Code』とある場所をクリックし、『https~』をコピーしましょう。
そしてgitbashで
```
git remote add origin https://github.com/GitHubのユーザ名/GitHubのリポジトリ名.git
```
とすることで、ファイルの送り先を設定します。

## git add

次にリモートリポジトリに送りたいファイルを、一旦ローカルリポジトリに送るためステージングエリアという場所に送る作業を行います。
(何言ってだ)

```
git add test.txt
```
また、フォルダの中にあるファイルを全部一気に持っていきたい時は
```
git add .
```
とすると、まとめて選んでくれます。

## git commit -m

次にステージングエリアにある内容をローカルリポジトリに送る作業を起こないます。なお、この際一緒にメッセージを添付する作業をします。何も言わずに急にファイルがボンと来ると怖いですし、自分でも昔に何を思ってファイルをアップロードしたのかが分からないと困ります。

```
git commit -m "Intial commit"
```
なのでこのようにして、メッセージを添付してあげます。

## git push

最後に送信を行います。
```
git push origin main
```

以上で終了です。

## まとめ
この一連の作業を『誰かに贈り物を送る』ことに例えてみると

- "git init"で自分の住所を書き
- "git remote add"で相手の住所を書き
- "git add"で贈り物を封筒に入れ
- "git commit -m"で手紙を書いて封を閉じ
- "git push"でポストに投函

となります。この例えどうでしょうか？(誰に聞いてるんだ)

ちなみに一度やると"git init"と"git remote add"は省略可能になります。場所を変更したい場合は同じやり方で上書きが出来るので安心してください。

## git status
飛ばしましたが、今リポジトリに反映されていない変更を確認する時には
```
git status
```
を使います。
すると、どのファイルが編集されたのか、どのファイルが新しく作られたのか、などが表示されます。

"git add"する前に確認しておくと良いかもしれない。


## git commit --amend -m
gitのコミットメッセージでタイポしてしまって、このままpushしたら恥ずかしい記録が残っちゃう～って時に使えるのがこのコマンド。

```
git commit --amend -m "Second commit"
```

しかし、この技は一つ前のコミットメッセージにしか適応できず、2つ以上前の物に対しては別の方法を取る必要があるので注意。

## git reset
commitの内容を取り消したい場合に使うコマンド。
ちなみに二種類あり、コミットだけを取り消したい場合は
```
git reset --soft HEAD^
```
で、一つ前のコミットだけ取り消せます(ファイルには変更なし)。

コミットだけでなく、ファイルの変更自体も取り消したい場合には
```
git reset --hard HEAD^
```
と打つと、コミットの前の段階に今の作業ディレクトリごと戻します。

どちらかというと使い方としては、「色々編集したけど、結局うまくいかなくて編集前に戻したい！」という時に使うのでしょうか。


# リモートリポジトリからローカルリポジトリにファイルを持ってくる

ローカルリポジトリをリモートリポジトリに同期させる方法について学びます。

## git fetch
リモートリポジトリの中身をアップストリームブランチという場所に持ってくるための作業を行います。リモートリポジトリに対する他の人のコミット履歴も取得できるので、一気にpullしてしまうより安全性は高いです。

```
git fetch
```

## git merge

git fetchで取得した情報を元にを元にローカルリポジトリとリモートリポジトリを同一の物に合わせます。
```
git merge
```

(作業ブランチをメインブランチに同期する作業でも同じく"git merge"を使うんだよな...)

この際、リモートリポジトリにはなくてローカルリポジトリにあるものは容赦なく消されるので気をつけてください。

## git pull

上のgit fechとgit mergeを一緒にやってくれるコマンドです。(正直これだけでよくね？と思ったけど、そうではないらしい)

```
git pull origin main
```
とします。pushの時と同じです。一応pushとpullで対応してるみたいです。

## 間違えてpullしてデータが消えた時
間違えてpullしちゃってデータが消えた時も安心してください。gitにコミット履歴が残るということは、そこから復元することも可能ということです。

pullの取り消しとは要するに、リモートブランチのマージを取り消すことなので、マージする前に遡ってあげればよいということになります。

```
git reflog
```
と打ち込みましょう。すると
```
321dd75 (origin/master, master) HEAD@{0}: merge: merging origin/master to master
321dd75 (origin/prod, prod)     HEAD@{1}: checkout: moving from temp to prod
eceee42 (origin/tmp, tmp)       HEAD@{2}: commit: fix the form bug.
321dd75 (origin/prod, prod)     HEAD@{3}: reset: moving to prod.
321dd75 (origin/prod, prod)     HEAD@{4}: checkout: moving from prod to temp
...
```
といったものが出てくるはずです。
そしたら、mergeの前に戻る、つまりHEAD@{1}に戻れば良いということなので

```
git reset --hard HEAD@{1}
```
と打ち込んであげるとあら不思議、ローカルリポジトリにファイルが戻ってきます。

# ブランチ
メインブランチで皆が一斉に作業するとぐちゃぐちゃになっちゃうため、作業ブランチといって、現在のメインブランチの状態から分岐して、メインブランチに影響を与えないブランチで作業をすることがと有効とされています。

## git switch
ブランチを作成する場合に使うコマンドです。
使い方としては
```
git switch -c <new-branchの名前>
```
とします。

このコマンドを実行すると、 コマンドラインに"(main)"の代わりに"(new-branch)"という表示がつきます。つまり、ブランチを作った上で、そこに移動しましたよーってことです。


## git branch
このコマンドでは現在のブランチの情報を調べることが出来ます。

上の"git switch"コマンドでブランチを作った状態で実行すると、
```
$ git branch
  main
* new-branch
```
というように、現在あるブランチの詳細と、今どのブランチにいるのかを教えてくれます。


# リモートリポジトリの内容を丸ごと手元に持ってくる

新規で始める時を除けば、基本的に既に行われているプロジェクトの途中から参加することになるでしょう。

その際の作業方法を説明します。
とはいっても一度実行するきりなので使うコマンドは1つだけです。

## git clone

```
git clone https://github.com/[ユーザー名]/[リポジトリ名].git
```
以上です。

"git remote add"の時とほとんど同じですね。

細かいコマンド等々は一応色々あるみたいですが、まあ一度キリなので、必要に応じて確認するので十分なんじゃないでしょうか。

>参考サイト
>https://tech-blog.rakus.co.jp/entry/20220624/git